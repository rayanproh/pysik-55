import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'
import { ThemeProvider } from './providers/theme-provider.jsx'
import { I18nextProvider } from 'react-i18next'
import i18n from "./i18n";

// Debug function
const debug = (message) => {
  console.log(`[Debug] ${message}`);
  // Also show debug info on page
  const debugElement = document.getElementById('debug-info') || (() => {
    const el = document.createElement('div');
    el.id = 'debug-info';
    el.style.cssText = 'position:fixed;top:0;left:0;background:rgba(0,0,0,0.8);color:white;padding:10px;z-index:9999;font-family:monospace;';
    document.body.appendChild(el);
    return el;
  })();
  debugElement.innerHTML += `${message}<br>`;
};

// Error handler
const handleError = (error) => {
  console.error('Application Error:', error);
  debug(`Error: ${error.message}`);
  // Show error on page
  document.body.innerHTML = `
    <div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#1a1a1a;color:white;padding:20px;direction:rtl;text-align:right;">
      <div>
        <h1 style="color:red;margin-bottom:20px;">خطأ في التطبيق</h1>
        <p style="margin-bottom:10px;">حدث خطأ أثناء تحميل التطبيق:</p>
        <pre style="background:#333;padding:10px;border-radius:4px;margin-top:10px;direction:ltr;">${error.message}</pre>
        <button onclick="location.reload()" style="margin-top:20px;padding:8px 16px;background:#4a5568;border:none;color:white;border-radius:4px;cursor:pointer;">
          إعادة تحميل الصفحة
        </button>
      </div>
    </div>
  `;
};

// Initialize app with debugging
try {
  debug('Starting application initialization...');
  
  const container = document.getElementById('root');
  if (!container) {
    throw new Error('Root element not found');
  }
  debug('Root element found');

  const root = createRoot(container);
  debug('React root created');

  // Add base styles
  document.documentElement.classList.add('h-full');
  document.body.classList.add('h-full', 'bg-background', 'text-foreground');
  
  debug('Rendering application...');
  root.render(
    <StrictMode>
      <I18nextProvider i18n={i18n}>
        <ThemeProvider defaultTheme="dark" storageKey="vite-ui-theme">
          <App />
        </ThemeProvider>
      </I18nextProvider>
    </StrictMode>
  );
  debug('Initial render complete');

} catch (error) {
  handleError(error);
  // Show a basic error message if rendering fails
  document.body.innerHTML = `
    <div style="display:flex;justify-content:center;align-items:center;height:100vh;background:#1a1a1a;color:white;text-align:center;padding:20px;">
      <div>
        <h1 style="color:red;margin-bottom:20px;">خطأ في التحميل</h1>
        <p>عذراً، حدث خطأ أثناء تحميل التطبيق. يرجى تحديث الصفحة.</p>
        <pre style="margin-top:20px;padding:10px;background:#333;border-radius:4px;font-size:12px;">${error.message}</pre>
      </div>
    </div>
  `;
}
